{% extends "_base.html" %}
{% block content %}

<h3 class="mb-4">
  <i class="bi bi-exclamation-circle me-2"></i>
  Danh sách khiếu nại
</h3>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nhân viên</th>
          <th>Lý do</th>
          <th>Ngày</th>
          <th>Trạng thái</th>
          <th style="width:180px;">Hành động</th>
        </tr>
      </thead>
      <tbody>
      {% for c in complaints %}
        <tr>
          <td>{{ c.id }}</td>
          <td>{{ c.user.full_name or c.user.username }}</td>
          <td>{{ c.reason }}</td>
          <td>{{ c.created_at.strftime("%d-%m-%Y %H:%M") }}</td>

          <td>
            {% if c.status == "pending" %}
              <span class="badge bg-warning text-dark">Đang chờ</span>
            {% elif c.status == "approved" %}
              <span class="badge bg-success">Đã duyệt</span>
            {% else %}
              <span class="badge bg-danger">Từ chối</span>
            {% endif %}
          </td>

          <td>
            {% if c.status == "pending" %}
            <form method="post"
                  action="{{ url_for('web_ui.update_complaint_status', id=c.id) }}"
                  class="d-flex gap-1">

              <button name="status" value="approved"
                      class="btn btn-sm btn-success">
                Duyệt
              </button>

              <button name="status" value="rejected"
                      class="btn btn-sm btn-danger">
                Từ chối
              </button>
            </form>
            {% else %}
              <span class="text-muted small">Đã xử lý</span>
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted py-4">
            Không có khiếu nại
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
