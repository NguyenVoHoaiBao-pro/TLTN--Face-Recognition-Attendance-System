{% extends "_base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">
    <i class="bi bi-people me-2"></i>Qu·∫£n l√Ω nh√¢n vi√™n
  </h3>

  <div class="d-flex gap-2">
    <a href="{{ url_for('web_ui.create_employee') }}" class="btn btn-success">
      <i class="bi bi-person-plus"></i> T·∫°o nh√¢n vi√™n
    </a>

    <a href="{{ url_for('web_ui.export_users') }}" class="btn btn-outline-success">
      <i class="bi bi-file-earmark-excel"></i> Xu·∫•t Excel
    </a>
  </div>
</div>

<!-- SEARCH -->
<div class="mb-3">
  <input
    type="text"
    id="searchInput"
    class="form-control"
    placeholder="üîç T√¨m theo t√™n, username, ph√≤ng ban..."
  >
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0" id="userTable">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>H·ªç t√™n</th>
            <th>Email</th>
            <th>Ph√≤ng ban</th>
            <th>Ch·ª©c v·ª•</th>
            <th>Role</th>
            <th class="text-center" style="width:140px;">H√†nh ƒë·ªông</th>
          </tr>
        </thead>

        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.id }}</td>
            <td class="fw-semibold">{{ u.username }}</td>
            <td>{{ u.full_name or "‚Äî" }}</td>
            <td>{{ u.email or "‚Äî" }}</td>
            <td>{{ u.department or "‚Äî" }}</td>
            <td>{{ u.position or "‚Äî" }}</td>
            <td>
              {% if u.role == "admin" %}
                <span class="badge bg-danger">Admin</span>
              {% else %}
                <span class="badge bg-primary">Employee</span>
              {% endif %}
            </td>
            <td class="text-center">
              <div class="btn-group btn-group-sm">

                <!-- Export ch·∫•m c√¥ng theo nh√¢n vi√™n -->
                <a
                  href="{{ url_for('web_ui.export_employee_attendance', user_id=u.id) }}"
                  class="btn btn-outline-success"
                  title="Xu·∫•t ch·∫•m c√¥ng"
                >
                  <i class="bi bi-file-earmark-excel"></i>
                </a>

                <!-- X√≥a nh√¢n vi√™n -->
                <form
                  method="post"
                  action="{{ url_for('web_ui.admin_users_delete', user_id=u.id) }}"
                  onsubmit="return confirm('X√≥a nh√¢n vi√™n n√†y?')"
                >
                  <button class="btn btn-outline-danger" title="X√≥a">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>

              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="8" class="text-center text-muted py-4">
              Ch∆∞a c√≥ nh√¢n vi√™n
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>
</div>

<!-- SEARCH JS -->
<script>
  document.getElementById("searchInput").addEventListener("keyup", function () {
    const keyword = this.value.toLowerCase();
    const rows = document.querySelectorAll("#userTable tbody tr");

    rows.forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(keyword)
        ? ""
        : "none";
    });
  });
</script>

{% endblock %}
