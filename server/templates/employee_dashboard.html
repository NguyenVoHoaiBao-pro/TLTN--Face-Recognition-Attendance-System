{% extends "_base.html" %}
{% block content %}
<h3 class="mb-3"><i class="bi bi-house-door me-2"></i>Employee Dashboard</h3>
<!-- Thông tin cá nhân -->
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <h5 class="mb-3">
      <i class="bi bi-person-circle me-2"></i>Thông tin cá nhân
    </h5>

    <div class="row">
      <div class="col-md-6">
        <p><strong>Họ tên:</strong> {{ user.full_name or "—" }}</p>
        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Tuổi:</strong> {{ user.age or "—" }}</p>
        <p><strong>Email:</strong> {{ user.email or "—" }}</p>
      </div>

      <div class="col-md-6">
        <p><strong>Số điện thoại:</strong> {{ user.phone or "—" }}</p>
        <p><strong>Phòng ban:</strong> {{ user.department or "—" }}</p>
        <p><strong>Chức vụ:</strong> {{ user.position or "—" }}</p>
        <p>
          <strong>Vai trò:</strong>
          {% if user.role == "admin" %}
            <span class="badge bg-danger">Admin</span>
          {% else %}
            <span class="badge bg-primary">Employee</span>
          {% endif %}
        </p>
      </div>
    </div>

  </div>
</div>


<!-- Nút hành động -->
<div class="mb-3">
  <a class="btn btn-outline-primary" href="{{ url_for('web_ui.enroll_face_page') }}">
    <i class="bi bi-camera"></i> Đăng ký khuôn mặt
  </a>
</div>

<!-- Lịch sử chấm công -->
<div class="card shadow-sm">
  <div class="card-body">
    <div class="fw-bold mb-2"><i class="bi bi-journal-text me-2"></i>Lịch sử chấm công</div>
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Hành động</th>
          <th>Thời gian</th>
          <th>Khiếu nại</th>
        </tr>
      </thead>
      <tbody>
      {% for r in recent %}
        <tr>
          <td>{{ r.id }}</td>
          <td>
            <span class="badge {% if r.action == 'Check-in' %}bg-success{% else %}bg-danger{% endif %}">
              {{ r.action }}
            </span>
          </td>
          <td>{{ r.timestamp }}</td>
          <td>
            <!-- Nút mở Modal -->
            <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal" data-bs-target="#complaintModal{{ r.id }}">
              <i class="bi bi-exclamation-circle"></i> Khiếu nại
            </button>

            <!-- Modal -->
            <div class="modal fade" id="complaintModal{{ r.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <form method="post" action="{{ url_for('web_ui.submit_complaint', attendance_id=r.id) }}">
                    <div class="modal-header">
                      <h5 class="modal-title">Gửi khiếu nại</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <p><strong>Bản ghi #{{ r.id }}</strong> - {{ r.action }} lúc {{ r.timestamp }}</p>
                      <div class="mb-3">
                        <label class="form-label">Lý do khiếu nại</label>
                        <input type="text" name="reason" class="form-control" required placeholder="Nhập lý do...">
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-warning">
                        <i class="bi bi-send"></i> Gửi
                      </button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <!-- End Modal -->
          </td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="text-center">Chưa có dữ liệu</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
